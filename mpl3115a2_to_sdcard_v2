#include <SD.h> //Load SD card library
#include<SPI.h> //Load SPI Library


#include "Wire.h"    // imports the wire library for talking over I2C 
#include <Adafruit_MPL3115A2.h>  // import the Pressure Sensor Library We are using Version one of Adafruit API for this sensor
Adafruit_MPL3115A2 mySensor;  // create sensor object called mySensor


float pressure; // Variable for holding pressure reading
float altitude; // Variable for holding altitude reading
float temperature; // Variable for holding temp in C (default)

int chipSelect = 4; //chipSelect pin for the SD card Reader
File mySensorData; //Data object you will write your sensor data to

void setup(){
Serial.begin(9600); //turn on serial monitor
mySensor.begin();   //initialize pressure sensor mySensor

pinMode(10, OUTPUT); //Must declare 10 an output and reserve it
SD.begin(4); //Initialize the SD card reader
}

void loop() { 
  pressure = mySensor.getPressure(); // Read Pressure
  altitude = mySensor.getAltitude(); //Read Altitude
  temperature = mySensor.getTemperature(); //  Read Temperature from MPL3115A2
  
  mySensorData = SD.open("PTData.txt", FILE_WRITE);
  if (mySensorData) {
    /* 
  Serial.print("The Temp is: "); //Print Your results
  Serial.print(tempF);
  Serial.println(" degrees F");
  Serial.print("The Pressure is: ");
  Serial.print(pressure);
  Serial.println(" Pa.");
  Serial.println("");
  */
  
  Serial.print("pressure = "); Serial.print(pressure); Serial.println(" hPa");
  Serial.print("altitude = "); Serial.print(altitude); Serial.println(" m");
  Serial.print("temperature = "); Serial.print(temperature); Serial.println(" C");
  
  delay(250); //Pause between readings.
  
  
  mySensorData.print(pressure);                        //write pressure data to card
  mySensorData.print(",");                             //write a commma
  mySensorData.print(altitude);                        //write altitude data to card
  mySensorData.print(",");                             //write a commma
  mySensorData.println(temperature);                   //write temperature and end the line (println)
  mySensorData.close();                                //close the file
  }
}
